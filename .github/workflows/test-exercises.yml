name: Test Exercises

on: [push, pull_request]

jobs:
  run-tests:
    runs-on: ubuntu-latest

    container:
      image: clfoundation/sbcl
        
    steps:
      - name: Checkout
        uses: actions/checkout@v2.3.4

      - name: Install & Setup QuickLisp
        run: |
          QUICKLISP_ADD_TO_INIT_FILE=true /usr/local/bin/install-quicklisp
          echo '(push (merge-pathnames "src/") asdf:*central-registry*)' >> ~/.sbclrc

      - name: SBCL Version
        run: (format t "~A-~A" (lisp-implementation-type) (lisp-implementation-version))
        shell: sbcl --noinform --non-interactive --load {0}

      - name: Run Tests
        run: |
          (ql:quickload "test-exercises")
          (asdf:test-system "test-exercises")
        shell: sbcl --noinform --non-interactive --load {0}
